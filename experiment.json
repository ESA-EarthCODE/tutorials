{"version":2,"kind":"Notebook","sha256":"b6d6104849caf32180a4838c6e4630ba795c481c167dda9b8cd40130efeedc66","slug":"experiment","location":"/openeo/2_experiment.ipynb","dependencies":[],"frontmatter":{"title":"Creating an experiment","content_includes_title":false,"kernelspec":{"name":"python3","display_name":".venv (3.13.2)","language":"python"},"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"github":"https://github.com/ESA-EarthCODE/tutorials","subject":"EarthCODE Tutorials","numbering":{"title":{"offset":1}},"source_url":"https://github.com/ESA-EarthCODE/tutorials/blob/main/openeo/2_experiment.ipynb","edit_url":"https://github.com/ESA-EarthCODE/tutorials/edit/main/openeo/2_experiment.ipynb","exports":[{"format":"ipynb","filename":"2_experiment.ipynb","url":"/tutorials/build/2_experiment-c3f5867e049e3842465b7b45381a912c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"With our workflow successfully created as an openEO User Defined Process (UDP) in our ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DcnY5Hgl47"},{"type":"link","url":"/workflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"previous tutorial","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vSBHCTjzEV"}],"urlSource":"./1_workflow.ipynb","dataUrl":"/workflow.json","internal":true,"protocol":"file","key":"CswHQuuyZe"},{"type":"text","value":", we can now set up an experiment. This involves executing the workflow with a predefined set of input parameters. By specifying parameters such as the area of interest and time range, we can tailor the experiment to generate meaningful results.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cMxQghf0Ep"}],"key":"rRU9nBeh3R"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Running the experiment will produce output products, which will be displayed at the end of the notebook. These results can then be further analyzed, shared with the scientific community, or published in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ojKTbESGea"},{"type":"link","url":"https://opensciencedata.esa.int/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"EarthCODE Open Science Catalogue","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"abKS2OayoC"}],"urlSource":"https://opensciencedata.esa.int/","key":"Ok09rgyiGe"},{"type":"text","value":" to promote reproducibility and collaboration.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oVE8JDq1X8"}],"key":"pgISjcbOOX"}],"key":"WjNMdSyni0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import rasterio\nimport matplotlib.pyplot as plt\n\ndef visualise_tif(path: str):\n    with rasterio.open(path) as src:\n        data = src.read(1)  # Read the first band\n        plt.figure(figsize=(10, 10))\n        plt.imshow(data, cmap='viridis')\n        plt.colorbar()\n        plt.show()","key":"VkcpagzZcU"},{"type":"output","id":"WMQsDS92F63Hiu-HhSTAg","data":[],"key":"EjzCHhXd2f"}],"key":"ubBzw1c4kY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Connection with CDSE openEO Federation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Hd5K2gkS9p"}],"identifier":"connection-with-cdse-openeo-federation","label":"Connection with CDSE openEO Federation","html_id":"connection-with-cdse-openeo-federation","implicit":true,"key":"SiugD4d1Q1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The first step, before creating the experiment in openEO, is to authenticate with an available openEO backend. In this example, we will use the CDSE openEO federation, which provides seamless access to both datasets and processing resources across multiple federated openEO backends.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uAzinHrvh4"}],"key":"t1gC5nRlAc"}],"key":"lclrWodcb8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import openeo","key":"XNpgyj0UHD"},{"type":"output","id":"IKe1VI1GkoAHj4JKdISU0","data":[],"key":"jABdxMNGxt"}],"key":"pnOQW5X5M4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"connection = openeo.connect(url=\"openeofed.dataspace.copernicus.eu\").authenticate_oidc()","key":"AT1C2FSvc3"},{"type":"output","id":"6eCqwZjqJRwF-y8Sw9kR3","data":[{"name":"stdout","output_type":"stream","text":"Authenticated using refresh token.\n"}],"key":"hRRPCijz0i"}],"key":"a0UniDGdF3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setting up the experiment","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Mo7bk42lDK"}],"identifier":"setting-up-the-experiment","label":"Setting up the experiment","html_id":"setting-up-the-experiment","implicit":true,"key":"pmRtOrH7mW"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this step, we will set up the experiment by defining the parameters for the variability map calculation. This includes specifying the area of interest, the time range, and any other relevant parameters that are required for the processing workflow. The experiment will be executed using the UDP from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UYUPYEFF4U"},{"type":"link","url":"/workflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"previous","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PTageIUpNM"}],"urlSource":"./1_workflow.ipynb","dataUrl":"/workflow.json","internal":true,"protocol":"file","key":"hUaHZukmly"},{"type":"text","value":" tutorial which yielded a public URL that can be used to execute the workflow. We will use this URL to set up our experiment, ensuring that the processing steps are applied correctly to the specified input data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z9qXJroKku"}],"key":"nJc9HgLCom"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"g8tIZp2KPU"}],"key":"K5C1O0atqK"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"As mentioned in our ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ahRpCOUYRK"},{"type":"crossReference","url":"/workflow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"workflow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZMASULuDNB"}],"urlSource":"./1_workflow.ipynb#exporting-your-workflow","dataUrl":"/workflow.json","identifier":"exporting-your-workflow","label":"exporting-your-workflow","remote":true,"protocol":"file","kind":"heading","template":"{name}","resolved":true,"html_id":"exporting-your-workflow","key":"lisggXy1Rs"},{"type":"text","value":" tutorial, the workflow URL can either refer to a definition stored on the openEO backendâ€”created using ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"aoAx3qHICN"},{"type":"inlineCode","value":"save_user_defined_process","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"RLIvuGX5gy"},{"type":"text","value":" with ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tOBKvzXpqE"},{"type":"inlineCode","value":"public=True","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZGP7Jv0eoN"},{"type":"text","value":", or to a public URL pointing to a JSON file hosted on GitHub or another platform.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"lSeqYrMyzM"}],"key":"R24jSeLn08"}],"key":"MWrkDaaywy"}],"key":"oxj9hyoZ08"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"workflow_url = \"https://openeo.dataspace.copernicus.eu/openeo/1.1/processes/u:6391851f-9042-4108-8b2a-3dd2e8a9dd0b/variability_map\" ","key":"drVsPKsLY7"},{"type":"output","id":"zJs1_vwvn6WbhVRz5R9yy","data":[],"key":"A1bxhiIKLd"}],"key":"hHeYd0KxRD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"spatial_extent_value = {\n  \"type\": \"FeatureCollection\",\n  \"features\": [\n    {\n      \"type\": \"Feature\",\n      \"properties\": {},\n      \"geometry\": {\n        \"coordinates\": [\n          [\n            [\n              5.170043941798298,\n              51.25050990858725\n            ],\n            [\n              5.171035037521989,\n              51.24865722468999\n            ],\n            [\n              5.178521828188366,\n              51.24674578027137\n            ],\n            [\n              5.179084341977159,\n              51.24984764553983\n            ],\n            [\n              5.170043941798298,\n              51.25050990858725\n            ]\n          ]\n        ],\n        \"type\": \"Polygon\"\n      }\n    }\n  ]\n}\n\ndate_value = \"2025-05-01\"","key":"baUM9EwSfR"},{"type":"output","id":"467BCGghBQ2XduyJJTC7N","data":[],"key":"UwOk31AQc7"}],"key":"KxzSYUWAm3"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can now execute our experiment using the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vkcExWdZtg"},{"type":"inlineCode","value":"datacube_from_process","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"InM2UYbyjx"},{"type":"text","value":" function and the information from the workflow we created:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BAFFwDmiFD"}],"key":"asDoz0Sm5k"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"process_id","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ytcBbqw9kZ"},{"type":"text","value":": the ID that we have assigned to our workflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cfjMs78EZ0"}],"key":"CKOEHhLwdn"}],"key":"VPIhv595wU"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"namespace","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"DJGFPTy9MZ"},{"type":"text","value":": the public URL of the workflow, which is provided as output of the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"JSpaAmh9gr"},{"type":"inlineCode","value":"save_user_defined_process","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"p9eKbbkaFu"},{"type":"text","value":" call","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"gN8Z7xQllj"}],"key":"irdyTq4lHA"}],"key":"GqcexA2xFa"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"**kwargs","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qPUuqJc6hh"},{"type":"text","value":": the parameters of the workflow. If a parameter is not specified, its default value will be used","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"J3NyExM9BH"}],"key":"pVJ1hUvPJk"}],"key":"sFFGVz88Yh"}],"key":"RfxueBaJcj"}],"key":"B6UXkMB5tE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"varmap_experiment = connection.datacube_from_process(\n    process_id=\"variability_map\",\n    namespace=workflow_url,\n    spatial_extent=spatial_extent_value,\n    date=date_value\n)","key":"PzvWkV0P8U"},{"type":"output","id":"ytVO8QWviQLHCi-AzSHwg","data":[],"key":"Bs2MQQBbgJ"}],"key":"VLnMLSim54"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now that we have created our experiment, we can explore how it is defined within openEO.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GuxdJ9YhP1"}],"key":"OuSc74BK9x"}],"key":"jzAByKljJz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import JSON\n\nJSON(varmap_experiment.to_json())","key":"osgCiSN3w5"},{"type":"output","id":"U9XHKcogedhjnry6abn_F","data":[{"name":"stderr","output_type":"stream","text":"/Users/bramjanssen/projects/earthcode/examples/.venv/lib/python3.13/site-packages/IPython/core/display.py:636: UserWarning: JSON expects JSONable dict or list, not JSON strings\n  warnings.warn(\"JSON expects JSONable dict or list, not JSON strings\")\n"},{"output_type":"execute_result","execution_count":7,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"process_graph\":{\"variabilitymap1\":{\"arguments\":{\"date\":\"2025-05-01\",\"spatial_extent\":{\"features\":[{\"geometry\":{\"coordinates\":[[[5.170043941798298,51.25050990858725],[5.171035037521989,51.24865722468999],[5.178521828188366,51.24674578027137],[5.179084341977159,51.24984764553983],[5.170043941798298,51.25050990858725]]],\"type\":\"Polygon\"},\"properties\":{},\"type\":\"Feature\"}],\"type\":\"FeatureCollection\"}},\"namespace\":\"https://openeo.dataspace.copernicus.eu/openeo/1.1/processes/u:6391851f-9042-4108-8b2a-3dd2e8a9dd0b/variability_map\",\"process_id\":\"variability_map\",\"result\":true}}}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}}],"key":"fPfP6TxEqG"}],"key":"Gjf8aiIFDY"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now that we have created our experiment, we can execute it by submitting it as an openEO batch job to the backend. This will trigger the processing workflow defined in our UDP, applying it to the specified input data. The output will be saved to a specified path, which we can then visualize or analyze further.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sOhzSFm3GE"}],"key":"qFH451q0pN"}],"key":"dGswvmzEQj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"path =  \"./files/varmap_experiment.tiff\"\nvarmap_experiment.execute_batch(\n    path,\n    title=\"CDSE Federation - Variability Map Experiment\", \n    description=\"This is an example experiment from CDSE containing the calculation of a variability map in Belgium\",\n)","key":"ckmYPHmEwD"},{"type":"output","id":"nVa3rtmpK_aWs_6fIU9-m","data":[{"name":"stdout","output_type":"stream","text":"0:00:00 Job 'cdse-j-250820065736495badba23b8ae4e7724': send 'start'\n0:00:13 Job 'cdse-j-250820065736495badba23b8ae4e7724': created (progress 0%)\n0:00:19 Job 'cdse-j-250820065736495badba23b8ae4e7724': created (progress 0%)\n0:00:29 Job 'cdse-j-250820065736495badba23b8ae4e7724': created (progress 0%)\n0:00:37 Job 'cdse-j-250820065736495badba23b8ae4e7724': running (progress N/A)\n0:00:47 Job 'cdse-j-250820065736495badba23b8ae4e7724': running (progress N/A)\n0:01:00 Job 'cdse-j-250820065736495badba23b8ae4e7724': running (progress N/A)\n0:01:15 Job 'cdse-j-250820065736495badba23b8ae4e7724': running (progress N/A)\n0:01:36 Job 'cdse-j-250820065736495badba23b8ae4e7724': finished (progress 100%)\n"},{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/html":{"content":"\n    <script>\n    if (!window.customElements || !window.customElements.get('openeo-job')) {\n        var el = document.createElement('script');\n        el.src = \"https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js\";\n        document.head.appendChild(el);\n\n        var font = document.createElement('font');\n        font.as = \"font\";\n        font.type = \"font/woff2\";\n        font.crossOrigin = true;\n        font.href = \"https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2\"\n        document.head.appendChild(font);\n    }\n    </script>\n    <openeo-job>\n        <script type=\"application/json\">{\"currency\": \"credits\", \"federation\": {\"cdse\": {\"description\": \"This openEO service runs on the [Copernicus Data Space Ecosystem](https://dataspace.copernicus.eu/)\\nand offers data access and processing on full archives of Copernicus data, such as the Sentinels.\", \"last_status_check\": \"2025-08-20T06:52:05Z\", \"status\": \"online\", \"title\": \"Copernicus Data Space Ecosystem openEO API\", \"url\": \"https://openeo.dataspace.copernicus.eu/openeo/1.1/\"}, \"terrascope\": {\"description\": \"OpenEO API to the Terrascope/VITO Remote Sensing product catalog and processing services (using GeoPySpark driver).\", \"last_status_check\": \"2025-08-20T06:52:05Z\", \"status\": \"online\", \"title\": \"VITO Remote Sensing openEO API\", \"url\": \"https://openeo-cdse.vito.be/openeo/1.1/\"}}, \"job\": {\"costs\": 4, \"created\": \"2025-08-20T06:57:36Z\", \"description\": \"This is an example experiment from CDSE containing the calculation of a variability map in Belgium\", \"id\": \"cdse-j-250820065736495badba23b8ae4e7724\", \"process\": {\"process_graph\": {\"saveresult1\": {\"arguments\": {\"data\": {\"from_node\": \"variabilitymap1\"}, \"format\": \"GTiff\", \"options\": {}}, \"process_id\": \"save_result\", \"result\": true}, \"variabilitymap1\": {\"arguments\": {\"date\": \"2025-05-01\", \"spatial_extent\": {\"features\": [{\"geometry\": {\"coordinates\": [[[5.170043941798298, 51.25050990858725], [5.171035037521989, 51.24865722468999], [5.178521828188366, 51.24674578027137], [5.179084341977159, 51.24984764553983], [5.170043941798298, 51.25050990858725]]], \"type\": \"Polygon\"}, \"properties\": {}, \"type\": \"Feature\"}], \"type\": \"FeatureCollection\"}}, \"namespace\": \"https://openeo.dataspace.copernicus.eu/openeo/1.1/processes/u:6391851f-9042-4108-8b2a-3dd2e8a9dd0b/variability_map\", \"process_id\": \"variability_map\"}}}, \"progress\": 100, \"status\": \"finished\", \"title\": \"CDSE Federation - Variability Map Experiment\", \"updated\": \"2025-08-20T06:59:11Z\", \"usage\": {\"cpu\": {\"unit\": \"cpu-seconds\", \"value\": 29}, \"duration\": {\"unit\": \"seconds\", \"value\": 65}, \"input_pixel\": {\"unit\": \"mega-pixel\", \"value\": 0.296875}, \"max_executor_memory\": {\"unit\": \"gb\", \"value\": 0.35710906982421875}, \"memory\": {\"unit\": \"mb-seconds\", \"value\": 113850}, \"network_received\": {\"unit\": \"b\", \"value\": 223684}}}}</script>\n    </openeo-job>\n    ","content_type":"text/html"},"text/plain":{"content":"<BatchJob job_id='cdse-j-250820065736495badba23b8ae4e7724'>","content_type":"text/plain"}}}],"key":"DX73j2fFXC"}],"key":"iHb3lVBJaT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"visualise_tif(path)","key":"MqDuOAyrGL"},{"type":"output","id":"Znk23YBX0RDAdjgPZ6yzq","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8dd3cd032dcbe3e6bc10644c867dac6b","path":"/tutorials/build/8dd3cd032dcbe3e6bc10644c867dac6b.png"},"text/plain":{"content":"<Figure size 1000x1000 with 2 Axes>","content_type":"text/plain"}}}],"key":"vThbGX8tFn"}],"key":"w874KH2tKv"}],"key":"rUQqmcSDR9"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Creating a workflow","url":"/workflow","group":"EarthCODE Tutorials"},"next":{"title":"Publishing an experiment to EarthCODE","url":"/publication","group":"EarthCODE Tutorials"}}},"domain":"http://localhost:3000"}