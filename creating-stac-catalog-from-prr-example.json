{"version":2,"kind":"Notebook","sha256":"0b5860e2c6e1279e165c33df05ed948bda679a1b2d320181c4162b1865391d2c","slug":"creating-stac-catalog-from-prr-example","location":"/PRR/Creating STAC Catalog_from_PRR_example.ipynb","dependencies":[],"frontmatter":{"title":"Generating metadata for the SRAL Processing over Land Ice Dataset","content_includes_title":false,"kernelspec":{"name":"conda-env-micromamba-pangeo-py","display_name":"Python [conda env:micromamba-pangeo] *","language":"python"},"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"github":"https://github.com/ESA-EarthCODE/tutorials","subject":"EarthCODE Tutorials","numbering":{"title":{"offset":1}},"source_url":"https://github.com/ESA-EarthCODE/tutorials/blob/main/PRR/Creating STAC Catalog_from_PRR_example.ipynb","edit_url":"https://github.com/ESA-EarthCODE/tutorials/edit/main/PRR/Creating STAC Catalog_from_PRR_example.ipynb","exports":[{"format":"ipynb","filename":"Creating STAC Catalog_from_PRR_example.ipynb","url":"/tutorials/build/Creating STAC Catalo-79e611818a588083adba0ab7f4a69a5d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This is an example notebook for creating the STAC Items uploaded to ESA Project Results Repository and made available at","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KnzyhCux5x"}],"key":"aNAWQaGCkb"},{"type":"text","value":": ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gUbeZCAgJX"},{"type":"link","url":"https://eoresults.esa.int/browser/#/external/eoresults.esa.int/stac/collections/sentinel3-ampli-ice-sheet-elevation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"https://â€‹eoresultsâ€‹.esaâ€‹.intâ€‹/browserâ€‹/â€‹#â€‹/externalâ€‹/eoresultsâ€‹.esaâ€‹.intâ€‹/stacâ€‹/collectionsâ€‹/sentinel3â€‹-ampliâ€‹-iceâ€‹-sheetâ€‹-elevation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cIwvgMaFj5"}],"urlSource":"https://eoresults.esa.int/browser/#/external/eoresults.esa.int/stac/collections/sentinel3-ampli-ice-sheet-elevation","key":"frkZm5Nh4I"}],"key":"lWF4614a3I"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Dataset is also discoverable via Open Science Catalogue, providing access to created in this tutorial collection stored in ESA Project Results Repository (PRR).\n","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YwLw0DsJS3"},{"type":"link","url":"https://opensciencedata.esa.int/products/sentinel3-ampli-ice-sheet-elevation/collection","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"https://â€‹opensciencedataâ€‹.esaâ€‹.intâ€‹/productsâ€‹/sentinel3â€‹-ampliâ€‹-iceâ€‹-sheetâ€‹-elevationâ€‹/collection","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XQrnynZLbJ"}],"urlSource":"https://opensciencedata.esa.int/products/sentinel3-ampli-ice-sheet-elevation/collection","key":"HZE45zLkqX"}],"key":"oQ24fubsHa"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"It focuses on generating metadata for a project with a hundreads of items, each of which has hundreads of ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"pKhdNQmwgn"},{"type":"inlineCode","value":"netcdf","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"lIyytCfgXH"},{"type":"text","value":" assets.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"SHXGSIxVQW"}],"key":"ktV2nuENE1"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Check the ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"YuFKPGAYHY"},{"type":"link","url":"https://earthcode.esa.int/","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"EarthCODE documentation","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"IImJ6k0nOK"}],"urlSource":"https://earthcode.esa.int/","key":"ako8isueY8"},{"type":"text","value":", and ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lvkfnXobSH"},{"type":"link","url":"https://esa-earthcode.github.io/tutorials/prr-stac-introduction","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"PRR STAC introduction example","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"mepH3Uk1hX"}],"urlSource":"https://esa-earthcode.github.io/tutorials/prr-stac-introduction","key":"PSWi98qf26"},{"type":"text","value":" for a more general introduction to STAC and the ESA PRR.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ETZYB1Adbh"}],"key":"eQvFzrSnng"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"The code below demonstrates how to perform the necessary steps using real data from the ESA project **SRAL Processing over Land Ice\n**. With the focus of the project on improving Sentinel-3 altimetry performances over land ice.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"rfNVXWe0zm"}],"key":"slHdXGIbL8"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"ðŸ”— Check the : ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"M4nuzvbMca"},{"type":"link","url":"https://eoresults.esa.int/d/sentinel3-ampli-ice-sheet-elevation/2025/05/07/sentinel-3-ampli-user-handbook/S3_AMPLI_User_Handbook.pdf","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"User handbook","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"BacjGkYmlp"}],"urlSource":"https://eoresults.esa.int/d/sentinel3-ampli-ice-sheet-elevation/2025/05/07/sentinel-3-ampli-user-handbook/S3_AMPLI_User_Handbook.pdf","key":"GnKOWUmFQ0"}],"key":"jItC57Joy8"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"ðŸ”— Check the : ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"XXr47fXfLC"},{"type":"cite","url":"http://doi.org/https://doi.org/10.57780/s3d-83ad619","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Scientifc publication","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"h3OonkGTWB"}],"kind":"narrative","label":"https://doi.org/10.57780/s3d-83ad619","identifier":"http://doi.org/https://doi.org/10.57780/s3d-83ad619","enumerator":"1","key":"voUhdI9jFN"}],"key":"N7cdZ0P6ph"},{"type":"heading","depth":4,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Acknowledgment","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"bX5Ntl9LHK"}],"identifier":"acknowledgment","label":"Acknowledgment","html_id":"acknowledgment","implicit":true,"key":"EI5d5oDpfD"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"We gratefully acknowledge the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"gFUD8f10l7"},{"type":"strong","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"SRAL Processing over Land Ice team","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"OMaaga9OiQ"}],"key":"eHtI27RSKM"},{"type":"text","value":" for providing access to the data used in this example, as well as support in creating it.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"bRAVfI4uZY"}],"key":"AfVPqSoiL7"},{"type":"heading","depth":3,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Steps described in this notebook","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"I2BkRCV1WM"}],"identifier":"steps-described-in-this-notebook","label":"Steps described in this notebook","html_id":"steps-described-in-this-notebook","implicit":true,"key":"elGTNkfiHk"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"This notebook presents the workflow for generating a PRR Collection for the entire dataset coming from the project. To create a valid STAC Items and Collection you should follow steps described below:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Vs6dMI3LM3"}],"key":"PIY6vtyrWe"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":27,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Generate a root STAC Collection","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"UGz83AWAX4"}],"key":"eJAZN2n2eX"}],"key":"yMe6MDV7mO"},{"type":"listItem","spread":true,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Group your dataset files into STAC Items and STAC Assets","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"twDrerEY9m"}],"key":"vQcI37dCjd"}],"key":"Wm3KU0OHLg"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add the Items to the collection","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"BzDogrMMQO"}],"key":"EJbvZn6j2w"}],"key":"yyANioF5Cz"},{"type":"listItem","spread":true,"position":{"start":{"line":30,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Save the normalised collection","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"NTZnmCGChe"}],"key":"wikTX4Efca"}],"key":"PGbhFpHxbu"}],"key":"W2DIMSdACy"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"Due to the complexity of the project and the time it takes to process the data, the STAC Items are generated first and stored locally. They are added to the collection afterwards.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"h3YJ8yY1Pi"}],"key":"QuW4kpfClO"},{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"This notebook can be used as an example for following scenario(s):","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"BcSJdM74f6"}],"key":"H0OUcqHTnS"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":35,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Creating the STAC Items from the files stored locally","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"Ys0N2eqyKP"}],"key":"iOQwNTFrBN"}],"key":"LVAeup0Q2f"},{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Creating the STAC Items from files stored in the s3bucket or other cloud repository","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"bhw7KscYUo"}],"key":"idwWAVMxzA"}],"key":"CjdWbjGSxV"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Creating the STAC Items from files already ingested into PRR","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"WC3K5nXxPF"}],"key":"HmTnIeBYuO"}],"key":"RPKEgdt8NW"}],"key":"rYD2AqVBVl"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Of course if your files are locally stored, or stored in a different S3 Bucket the access to them (roor_url and items paths) should be adapted according to your dataset location.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"FBfqyr6aZD"}],"key":"a7Bhwpwt8y"},{"type":"blockquote","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"Note: Due to the original size of the dataset ~ 100GB, running this notebook end to end may take hours. We do advise therefore to trying it on your own datasets by changing file paths to be able to produe valid STAC Collaction and STAC Items.","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"HCZTDoMBCz"}],"key":"SCDDn0ZdKF"}],"key":"sheUUnUFBQ"}],"key":"oXO9k1MTBF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Loading Libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iBiAZiwm7g"}],"identifier":"loading-libraries","label":"Loading Libraries","html_id":"loading-libraries","implicit":true,"key":"lx8Sm2iwBr"}],"key":"zedm1pR8xj"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import json\nimport time\nimport pystac\nimport rasterio\nfrom shapely import box\nimport pandas as pd\nimport xarray as xr\nfrom datetime import datetime\nfrom dateutil.parser import isoparse\nfrom dateutil import parser\nfrom dateutil.parser import parse","visibility":"show","key":"mecJDxC6MT"},{"type":"output","id":"AHc_72TGCjfkbKGZn-plF","data":[],"visibility":"show","key":"TNDDBvgFBF"}],"visibility":"show","key":"anq5sRLa1h"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. Get Product file links","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Unf16DCJJy"}],"identifier":"id-2-get-product-file-links","label":"2. Get Product file links","html_id":"id-2-get-product-file-links","implicit":true,"key":"Xka3Sl3RSt"},{"type":"blockquote","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Note: We are using the links from the PRR directly, however when the notebook was created originally all the files were available locally. Furthermore, due to the original size of the dataset ~ 100GB, running this notebook end to end may take hours. We do advise therefore to trying it on your own datasets by changing file paths to be able to produe valid STAC Collaction and STAC Items.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iddo4sA5ON"}],"key":"mhIbkKKVz2"}],"key":"C2w5SG1Dbl"}],"key":"iEpbKdcVn9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"root_url = 'https://eoresults.esa.int' # provide a root url for the datasets items ","key":"hheykFsPk2"},{"type":"output","id":"KL1K7fLBmfexPhPMuGcvg","data":[],"key":"ximOfuWZGS"}],"key":"vlpLsOWopN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# get all items for the S3 AMPLI collection from the PRR STAC API\nitems = pystac.ItemCollection.from_file('https://eoresults.esa.int/stac/collections/sentinel3-ampli-ice-sheet-elevation/items?limit=10_000')","key":"JDSK3ANNZI"},{"type":"output","id":"sA0qh9j7nDUVGuSjIaV5d","data":[],"key":"xn1uI5ihN9"}],"key":"qvr3LoUjUu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# get the paths to all the data\n\n# using a dictionary is faster than using pystac\nitems_dict = items.to_dict()\nall_item_paths = []\nfor item in items_dict['features']:\n    assets = item['assets']\n    for asset_name, asset_dict in assets.items():\n        if asset_dict['roles'] == ['data']:\n            all_item_paths.append(asset_dict['href'])","key":"Ck8Mpsv4G1"},{"type":"output","id":"2V-yVc0uNsPhSh1xYob1x","data":[],"key":"BgP05LF72O"}],"key":"xHpYWoemQ1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create a list of EO Missions and instruments as well as region of the dataset and cycles\ninstruments = ['sentinel-3a', 'sentinel-3b']\nregions = ['antarctica', 'greenland']\ncycles = [f\"cycle{str(i).zfill(3)}\" for i in range(5, 112)]  # Cycle005 to Cycle111","key":"i7JOFANfOf"},{"type":"output","id":"Sd1IY1NIxiJsnP_S_BoK4","data":[],"key":"wfMOvbLQVZ"}],"key":"Htt6RSA8yO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Assign the instrument name based on the acronym used in the file name\nrenaming = {\n    'S3A': 'sentinel-3a',\n    'S3B': 'sentinel-3b',\n    'ANT': 'antarctica',\n    'GRE': 'greenland'\n}","key":"xpqUkZXNoZ"},{"type":"output","id":"2-8Y2agAQViZNjtMUns3i","data":[],"key":"ds1U6qABe6"}],"key":"UbKz9ZyR4z"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define geometries, which are the same for all items within the same region. If they are not, these have to be extracted from the assets inside the item.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cAxvPnfIh3"}],"key":"vqa257X48d"}],"key":"JuQ1ejY0rb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define the spatial extent (bbox) for each region of interest\ngreenland_bbox = [-74.0, 59.0, -10.0, 84.0]\ngreenland_geometry = json.loads(json.dumps(box(*greenland_bbox).__geo_interface__))\n\nantarctica_bbox = [-180.0, -90.0, 180.0, -60.0]\nantarctica_geometry = json.loads(json.dumps(box(*antarctica_bbox).__geo_interface__))\n","key":"ilgtxkgZxv"},{"type":"output","id":"4idBVS9RIvxbKvFfYidN4","data":[],"key":"ujctlMEhmC"}],"key":"uG7ovAMupS"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2.1 Group the files by the instruments, region and cycle of the dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Kuh9Pscrcf"}],"identifier":"id-2-1-group-the-files-by-the-instruments-region-and-cycle-of-the-dataset","label":"2.1 Group the files by the instruments, region and cycle of the dataset","html_id":"id-2-1-group-the-files-by-the-instruments-region-and-cycle-of-the-dataset","implicit":true,"key":"F9d0m35yGI"}],"key":"KUKqnhORsM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data = []\n\nfor ipath in all_item_paths:\n    splitname = ipath.split('/')[-1].split('_')\n    instrument = splitname[0]\n    cycle = splitname[9]\n    region = splitname[-2]\n\n    data.append((renaming[instrument], renaming[region], cycle, ipath))\n\n\nfiledata = pd.DataFrame(data, columns=['instrument', 'region', 'cycle', 'path'])","key":"peKYHV5Jc4"},{"type":"output","id":"QFc_Gds0Zvxt5iro3dMAc","data":[],"key":"ARhjO0TH9l"}],"key":"Uw1eOkN7rU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3. Create the STAC Items with the metadata from the original files loaded from the PRR","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QtaNrgcXXr"}],"identifier":"id-3-create-the-stac-items-with-the-metadata-from-the-original-files-loaded-from-the-prr","label":"3. Create the STAC Items with the metadata from the original files loaded from the PRR","html_id":"id-3-create-the-stac-items-with-the-metadata-from-the-original-files-loaded-from-the-prr","implicit":true,"key":"POb9Js1Uga"}],"key":"S2xW3VNVke"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# group all files into items from the same instrument, region and cycle\nfor (instrument, region, cycle), links in filedata.groupby(['instrument', 'region', 'cycle']):\n    \n    # open the metadata attributes for each file in the group\n    datasets = [xr.open_dataset(root_url + link + '#mode=bytes') for link in links['path']]\n\n\n    # Define the Temporal extent\n    first_item = datasets[0]\n    last_item = datasets[-1]\n    props = first_item.attrs\n    props2 = last_item.attrs\n\n    start_datetime = props.get(\"first_meas_time\")\n    end_datetime = props2.get(\"last_meas_time\")\n\n    # Define the geometry\n    if props['zone'] == 'Antarctica':\n        bbox = antarctica_bbox\n        geometry = antarctica_geometry\n    elif props['zone'] == 'Greenland':\n        bbox = greenland_bbox\n        geometry = greenland_geometry\n\n\n    # Shared properties\n    properties = {\n        \"start_datetime\": start_datetime,\n        \"end_datetime\": end_datetime,\n        \"created\": props.get(\"processing_date\"),\n        \"description\": f\"Sentinel-3 AMPLI Land Ice Level-2 product acquired by {instrument.capitalize()} platform derived from the SRAL altimeter in Earth Observation mode over {region} region.\",\n        \"conventions\": props.get(\"Conventions\"),\n        \"platform_name\": props.get(\"platform_name\"),\n        \"platform_serial_identifier\": props.get(\"platform_serial_identifier\"),\n        \"altimeter_sensor_name\": props.get(\"altimeter_sensor_name\"),\n        \"operational_mode\": props.get(\"operational_mode\"),\n        \"cycle_number\": props.get(\"cycle_number\"),\n        \"netcdf_version\": props.get(\"netcdf_version\"),\n        \"product_type\": props.get(\"product_type\"),\n        \"timeliness\": props.get(\"timeliness\"),\n        \"institution\": props.get(\"institution\"),\n        \"processing_level\": props.get(\"processing_level\"),\n        \"processor_name\": props.get(\"processor_name\"),\n        \"processor_version\": props.get(\"processor_version\"),\n        \"references\": props.get(\"references\"),\n        \"zone\": props.get(\"zone\"),\n    }\n\n\n    # Create STAC item for the cycle\n    item = pystac.Item(\n        id=f\"sentinel-3{props.get(\"platform_serial_identifier\").lower()}-{props.get(\"zone\").lower()}-{cycle.lower()}\",\n        geometry=geometry,\n        bbox=bbox,\n        datetime=isoparse(start_datetime),\n        properties=properties\n    )\n\n    item.stac_version = \"1.1.0\"\n    item.stac_extensions = [\n        \"https://stac-extensions.github.io/projection/v1.1.0/schema.json\",\n        \"https://stac-extensions.github.io/raster/v1.1.0/schema.json\",\n        \"https://stac-extensions.github.io/eo/v1.1.0/schema.json\"\n    ]\n\n    item.assets = {}\n\n    # Add assets from that cycle\n    for nc_href, ds in zip(links['path'], datasets):\n\n        asset_title = ds.attrs['product_name']\n        extra_fields = {\n            \"cycle_number\": str(ds.attrs.get(\"cycle_number\")),\n            \"orbit_number\": str(ds.attrs.get(\"orbit_number\")),\n            \"relative_orbit_number\": str(ds.attrs.get(\"relative_orbit_number\")),\n            \"orbit_direction\": ds.attrs.get(\"orbit_direction\"),\n        }\n\n        item.add_asset(\n            key=asset_title,\n            asset=pystac.Asset(\n                href=nc_href,\n                media_type=\"application/x-netcdf\",\n                roles=[\"data\"],\n                extra_fields=extra_fields\n            )\n        )\n\n    # Save STAC item per cycle\n    json_filename = f\"sentinel-3{props.get(\"platform_serial_identifier\").lower()}-{props.get(\"zone\").lower()}-{cycle.lower()}.json\"\n    item.save_object(dest_href='examples/' + json_filename, include_self_link=False)\n    print(f\" Saved {json_filename}\")","key":"Y8xatrXybE"},{"type":"output","id":"TIDfUMuNUnweQLfjUmCW_","data":[],"key":"V8LGAuxi6h"}],"key":"KiDZSejc4u"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.1  Import documentation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bZl0B4WyVB"}],"identifier":"id-3-1-import-documentation","label":"3.1  Import documentation","html_id":"id-3-1-import-documentation","implicit":true,"key":"jUaVEkj61S"}],"key":"fF0fopiVmZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pystac\nfrom datetime import datetime\nimport os\nfrom datetime import datetime, timezone\n\ndate_str = \"07/05/2025\"\n\n# Convert to ISO format string (YYYY-MM-DD)\niso_like_str = datetime.strptime(date_str, \"%d/%m/%Y\").strftime(\"%Y-%m-%d\")\n\n# Parse with isoparse and attach UTC timezone\ndt_utc = isoparse(iso_like_str).replace(tzinfo=timezone.utc)\n\nprint(dt_utc.isoformat())","key":"t9pLIeE6Za"},{"type":"output","id":"MoRuOET0HH0qltIT5ZR7d","data":[],"key":"Q2j3gl1dRq"}],"key":"azyrr1EnyU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.2  Create STAC Item for the documentation associated to the dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xGX6pJc37f"}],"identifier":"id-3-2-create-stac-item-for-the-documentation-associated-to-the-dataset","label":"3.2  Create STAC Item for the documentation associated to the dataset","html_id":"id-3-2-create-stac-item-for-the-documentation-associated-to-the-dataset","implicit":true,"key":"qxBtIkwK3C"}],"key":"ZPBawdXRHs"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Basic metadata\ndoc_href = \"/d/S3_AMPLI_User_Handbook.pdf\"  # Relative or absolute href\ndoc_title = \"Sentinel-3 Altimetry over Land Ice: AMPLI level-2 Products\"\ndoc_description = \"User Handbook for Sentinel-3 Altimetry over Land Ice: AMPLI level-2 Products\"\n\n# Create STAC item\nitem = pystac.Item(\n    id=\"sentinel-3-ampli-user-handbook\",\n    geometry=None,\n    bbox=None,\n    datetime=dt_utc,\n    properties={\n        \"title\": doc_title,\n        \"description\": doc_description,\n        \"reference\": \"CLS-ENV-MU-24-0389\",\n        \"issue_n\": dt_utc.isoformat()\n    }\n)\n\n# Add asset for the PDF\nitem.add_asset(\n    key=\"documentation\",\n    asset=pystac.Asset(\n        href=doc_href,\n        media_type=\"application/pdf\",\n        roles=[\"documentation\"],\n        title=doc_title\n    )\n)\n\n# Save to file\nitem.set_self_href(\"examples/sentinel-3-ampli-user-handbook.json\")\nitem.save_object(include_self_link=False)\n\nprint(\"ðŸ“„ STAC Item for documentation created: sentinel-3-ampli-user-handbook.json\")","visibility":"show","key":"LzdYLomC3c"},{"type":"output","id":"huD4ikvj7fmrkFX7kbHbz","data":[],"visibility":"show","key":"WJkENmHeGe"}],"visibility":"show","key":"jo8GwV5P7t"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4. Generate valid STAC collection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xOpLXneNzM"}],"identifier":"id-4-generate-valid-stac-collection","label":"4. Generate valid STAC collection","html_id":"id-4-generate-valid-stac-collection","implicit":true,"key":"ECGgNdwmTu"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Once all the assets are processed, create the parent collection for all Items created in the previous step.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AhXfDBOYCA"}],"key":"k7yfsroUYy"}],"key":"vOEVkTuICf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"collection = pystac.Collection.from_dict(\n\n{\n  \"id\": \"sentinel3-ampli-ice-sheet-elevation\",\n  \"type\": \"Collection\",\n  \"links\": [\n  ],\n  \"title\": \"Sentinel-3 AMPLI Ice Sheet Elevation\",\n  \"extent\": {\n    \"spatial\": {\n      \"bbox\": [\n        [-180, -90, 180, 90]\n      ]\n    },\n    \"temporal\": {\n      \"interval\": [\n        [\n          \"2016-06-01T00:00:00Z\",\n          \"2024-05-09T00:00:00Z\"\n        ]\n      ]\n    }\n  },\n  \"license\": \"CC-BY-4.0\",\n  \"summaries\": {\n    \"references\": [\n      \"https://doi.org/10.5194/egusphere-2024-1323\"\n    ],\n    \"institution\": [\n      \"CNES\"\n    ],\n    \"platform_name\": [\n      \"SENTINEL-3\"\n    ],\n    \"processor_name\": [\n      \"Altimeter data Modelling and Processing for Land Ice (AMPLI)\"\n    ],\n    \"operational_mode\": [\n      \"Earth Observation\"\n    ],\n    \"processing_level\": [\n      \"2\"\n    ],\n    \"processor_version\": [\n      \"v1.0\"\n    ],\n    \"altimeter_sensor_name\": [\n      \"SRAL\"\n    ]\n  },\n  \"description\": \"Ice sheet elevation estimated along the Sentinel-3 satellite track, as retrieved with the Altimeter data Modelling and Processing for Land Ice (AMPLI). The products cover Antarctica and Greenland.\",\n  \"stac_version\": \"1.1.0\"\n}\n)\ncollection","key":"KfdG7uUn8I"},{"type":"output","id":"cAgcJMAuFiL9ym1liNV_b","data":[],"key":"jEHibvImeU"}],"key":"vVaIBntaH7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4.1. Add items to collection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hvoVDDxFxK"}],"identifier":"id-4-1-add-items-to-collection","label":"4.1. Add items to collection","html_id":"id-4-1-add-items-to-collection","implicit":true,"key":"QW7i4Bxihs"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Once the collection is created read all the items from disk and add the necassary links.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gS1pPINZmU"}],"key":"eXJ3AqVAAJ"}],"key":"b0gHnAWRwn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import glob\nfor fpath in glob.glob('examples/*'):\n    collection.add_item(pystac.Item.from_file(fpath))","key":"ef3VB1mZb7"},{"type":"output","id":"ix6Atxq0fuwkSYoaJXZYz","data":[],"key":"ElU6cWHoM1"}],"key":"X9eWT5BjKD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4.2 Save the normalised collection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pSv1kKK7Uj"}],"identifier":"id-4-2-save-the-normalised-collection","label":"4.2 Save the normalised collection","html_id":"id-4-2-save-the-normalised-collection","implicit":true,"key":"oyWc2VYg5y"}],"key":"Udb9CxRUKx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# save the full self-contained collection\ncollection.normalize_and_save(\n    root_href='../data/example_catalog_ampli/',\n    catalog_type=pystac.CatalogType.SELF_CONTAINED\n)","key":"NmcnY6eSQ6"},{"type":"output","id":"XcgASJ64--u5YNvlbwHMu","data":[],"key":"JPTl5qaxHQ"}],"key":"kzgQc1IXDM"}],"key":"O8KY1skFz5"},"references":{"cite":{"order":["https://doi.org/10.57780/s3d-83ad619"],"data":{"https://doi.org/10.57780/s3d-83ad619":{"label":"https://doi.org/10.57780/s3d-83ad619","enumerator":"1","doi":"10.57780/S3D-83AD619","html":"European Space Agency. (2025). <i>Sentinel-3 AMPLI Ice Sheet Elevation</i>. European Space Agency. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.57780/S3D-83AD619\">10.57780/S3D-83AD619</a>","url":"https://doi.org/10.57780/S3D-83AD619"}}}},"footer":{"navigation":{"prev":{"title":"Generating STAC metadata for the YIPEEO project","url":"/prr-zarr","group":"EarthCODE Tutorials"},"next":{"title":"Generating STAC metadatas for the TCCAS dataset","url":"/tccas-v2","group":"EarthCODE Tutorials"}}},"domain":"http://localhost:3000"}